(this.webpackJsonptwistyeditor=this.webpackJsonptwistyeditor||[]).push([[0],{100:function(e,t,i){},266:function(e,t,i){"use strict";i.r(t);var r=i(1),n=i.n(r),a=i(89),o=i.n(a),s=(i(100),i(4)),h=i(5),l=i(15),c=i(14),u=(i(35),i(0)),m=function e(t,i){Object(s.a)(this,e),this.prism=t,this.renderable=i},d=function(){function e(t,i){Object(s.a)(this,e),this.shape=t,this.prismViews=[];for(var r=0;r<this.shape.prisms.length;r++)this.prismViews.push(this.createPrismView(this.shape.prisms[r],i));this.syncTransform(i)}return Object(h.a)(e,[{key:"createPrismView",value:function(e,t){var i=t.createPrismRenderable(e.colorMask,e.backgroundColor,e.foregroundColor);return new m(e,i)}},{key:"findPrismView",value:function(e){for(var t=0;t<this.prismViews.length;t++){var i=this.prismViews[t];if(i.prism.id===e)return i}return null}},{key:"addToScene",value:function(e){this.prismViews.forEach((function(t){return e.scene.addEntity(t.renderable)}))}},{key:"removeFromScene",value:function(e){this.prismViews.forEach((function(t){return e.scene.remove(t.renderable)}))}},{key:"syncTransform",value:function(e){for(var t=0;t<this.prismViews.length;t++){var i=this.prismViews[t],r=i.prism;e.setRenderableTransform(i.renderable,r.worldPosition,r.worldOrientation)}}}]),e}(),p=i(19),f=i.n(p),v=u.c.create(),g=u.c.create(),b=u.c.create(),P=u.c.create();function y(e,t,i,r){var n=u.c.sub(v,i,t),a=u.c.sub(g,r,t),o=u.c.cross(b,e.direction,a),s=u.c.dot(n,o);if(!(s<1e-6)){var h=u.c.sub(P,e.origin,t),l=u.c.dot(h,o);if(!(l<0||l>s)){var c=u.c.cross(P,h,n),m=u.c.dot(e.direction,c);if(!(m<0||l+m>s))return u.c.dot(a,c)/s}}}function w(e,t,i){var r=u.c.sub(v,e.origin,t),n=i*i,a=u.c.squaredLength(r);if(a<=n)return 0;var o=u.c.dot(e.direction,e.direction),s=2*u.c.dot(r,e.direction),h=s*s-4*o*(a-n);if(h>=0){var l=Math.sqrt(h),c=(-s-l)/(2*o);return c<0&&(c=(-s+l)/(2*o)),c}}function k(e,t){for(var i=0,r=0,n=0;n<t.length;n++){var a=u.c.dot(e,t[n]);0===n?(i=a,r=a):(a<i&&(i=a),a>r&&(r=a))}return{dmin:i,dmax:r}}function C(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.001;if(0===t.length||0===i.length)return!1;var n=k(e,t),a=k(e,i);return n.dmin+r<a.dmax&&a.dmin+r<n.dmax}function M(e,t){var i=u.c.sub(v,t,e.origin),r=u.c.scale(g,e.direction,u.c.dot(i,e.direction));return u.c.distance(i,r)}var x=.48*Math.PI,E=-Math.PI/10,R=-Math.PI/40,V="res/environment_ibl.ktx",S=function(e){return"res/prism"+e+".png"},T=function(e){var t=f()(e).toRgb();return[t.r/255,t.g/255,t.b/255]},F=u.b.create(),I=u.a.create(),O=function(e){Object(l.a)(i,e);var t=Object(c.a)(i);function i(){return Object(s.a)(this,i),t.apply(this,arguments)}return Object(h.a)(i,[{key:"componentDidMount",value:function(){for(var e=this,t=[V,"res/environment_skybox.ktx","res/prism.filamesh","res/prism.filamat","res/ghost.filamat","res/knob.filamesh","res/knob.filamat"],i=0;i<8;i++)t.push(S(i));window.Filament.init(t,(function(){e.init()}))}},{key:"componentDidUpdate",value:function(e){e.shape!==this.props.shape&&this.handleShapeChange()}},{key:"handleShapeChange",value:function(){this.engine&&(this.shapeView&&this.shapeView.removeFromScene(this),this.shapeView=new d(this.props.shape,this),this.shapeView.addToScene(this),this.activePrismView=null,this.selectPrism(this.props.activePrism,!1))}},{key:"init",value:function(){var e=this;this.elevation=E,this.heading=R,this.distance=10,this.activePrismView=null,this.availableJunctions=null,this.focalPoint=u.c.create(),this.targetPosition=u.c.create(),this.lastPosition=u.c.create(),this.highlightColor=[0,0,0,0],this.animationTimer=0,this.highlightTimer=0,this.pressing=!1,this.dragging=!1,this.pickedPrism=null,this.pickedJunction=null,this.activeJunctionPrism=null,this.pointerX=0,this.pointerY=0,this.canvas=this.filament;var t=this.engine=window.Filament.Engine.create(this.canvas);this.camera=t.createCamera(window.Filament.EntityManager.get().create()),this.scene=t.createScene();var i=t.createIblFromKtx(V);i.setIntensity(5e4),this.scene.setIndirectLight(i);var r=t.createSkyFromKtx("res/environment_skybox.ktx");this.scene.setSkybox(r),this.prismSourceMaterial=t.createMaterial("res/prism.filamat"),this.prismSourceMesh=t.loadFilamesh("res/prism.filamesh"),this.prismBoundingBox=this.getBoundingBox(this.prismSourceMesh.renderable);var n=t.createMaterial("res/ghost.filamat");this.ghostRenderable=this.buildPrismRenderable(n.getDefaultInstance()),this.knobSourceMaterial=t.createMaterial("res/knob.filamat"),this.knobSourceMesh=t.loadFilamesh("res/knob.filamesh"),this.knobBoundingBox=this.getBoundingBox(this.knobSourceMesh.renderable),this.knobRenderables=[],this.prismTextures=[];for(var a=0;a<8;a++)this.prismTextures.push(t.createTextureFromPng(S(a)));this.prismTextureSampler=new window.Filament.TextureSampler(window.Filament.MinFilter.LINEAR_MIPMAP_LINEAR,window.Filament.MagFilter.LINEAR,window.Filament.WrapMode.CLAMP_TO_EDGE),this.handleShapeChange(),this.swapChain=t.createSwapChain(),this.renderer=t.createRenderer(),this.view=t.createView(),this.view.setCamera(this.camera),this.view.setScene(this.scene),this.resize(),this.renderFrame=this.renderFrame.bind(this),this.resize=this.resize.bind(this),window.addEventListener("resize",this.resize),window.requestAnimationFrame(this.renderFrame),this.canvas.addEventListener("pointerdown",(function(t){return e.handlePointerDown(t)})),this.canvas.addEventListener("pointerup",(function(t){return e.handlePointerUp(t)})),this.canvas.addEventListener("pointermove",(function(t){return e.handlePointerMove(t)}))}},{key:"buildPrismRenderable",value:function(e){var t=window.Filament.EntityManager.get().create();return window.Filament.RenderableManager.Builder(1).boundingBox(this.prismBoundingBox).material(0,e).geometry(0,window.Filament.RenderableManager$PrimitiveType.TRIANGLES,this.prismSourceMesh.vertexBuffer,this.prismSourceMesh.indexBuffer).build(this.engine,t),t}},{key:"createPrismRenderable",value:function(e,t,i){var r=e>=0&&e<8?e:0,n=this.prismSourceMaterial.createInstance();return n.setTextureParameter("colorMask",this.prismTextures[r],this.prismTextureSampler),n.setColor3Parameter("backgroundColor",window.Filament.RgbType.sRGB,T(t)),n.setColor3Parameter("foregroundColor",window.Filament.RgbType.sRGB,T(i)),n.setColor4Parameter("highlightColor",window.Filament.RgbaType.sRGB,[0,0,0,0]),this.buildPrismRenderable(n)}},{key:"createKnobRenderable",value:function(){var e=this.knobSourceMaterial.createInstance();e.setFloatParameter("alpha",0);var t=window.Filament.EntityManager.get().create();return window.Filament.RenderableManager.Builder(1).boundingBox(this.knobBoundingBox).material(0,e).geometry(0,window.Filament.RenderableManager$PrimitiveType.TRIANGLES,this.knobSourceMesh.vertexBuffer,this.knobSourceMesh.indexBuffer).build(this.engine,t),t}},{key:"getBoundingBox",value:function(e){var t=this.engine.getRenderableManager(),i=t.getInstance(e),r=t.getAxisAlignedBoundingBox(i);return i.delete(),r}},{key:"setRenderableTransform",value:function(e,t,i){var r=this.engine.getTransformManager(),n=r.getInstance(e),a=u.a.fromRotationTranslation(I,i,t);r.setTransform(n,a),n.delete()}},{key:"getRenderableMaterial",value:function(e){var t=this.engine.getRenderableManager(),i=t.getInstance(e),r=t.getMaterialInstanceAt(i,0);return i.delete(),r}},{key:"updateCamera",value:function(){var e=[this.focalPoint[0],this.focalPoint[1],this.focalPoint[2]+this.distance];u.c.rotateX(e,e,this.focalPoint,this.elevation),u.c.rotateY(e,e,this.focalPoint,this.heading),this.camera.lookAt(e,this.focalPoint,[0,1,0])}},{key:"renderFrame",value:function(e){void 0===this.lastTime&&(this.lastTime=e);var t=.001*(e-this.lastTime);if(this.lastTime=e,this.animationTimer<.3){this.animationTimer+=t;var i=Math.min(this.animationTimer/.3,1),r=i*i*(3-2*i);u.c.lerp(this.focalPoint,this.lastPosition,this.targetPosition,r),this.updateCamera()}if(this.activePrismView){this.highlightTimer+=t,this.highlightTimer>2&&(this.highlightTimer%=2);var n=2*Math.abs(this.highlightTimer/2-.5),a=.3+.5*(n*n*(3-2*n));this.setHighlightIntensity(this.activePrismView,a)}this.renderer.render(this.swapChain,this.view),window.requestAnimationFrame(this.renderFrame)}},{key:"resize",value:function(){var e=window.devicePixelRatio,t=this.canvas.width=.8*window.innerWidth*e,i=this.canvas.height=window.innerHeight*e;this.view.setViewport([0,0,t,i]),this.camera.setProjectionFov(45,t/i,1,100,window.Filament.Camera$Fov.VERTICAL)}},{key:"isPrimaryPointer",value:function(e){return"touch"!==e.pointerType||e.isPrimary}},{key:"handlePointerDown",value:function(e){if(this.isPrimaryPointer(e)){var t,i=this.getCastingRay(e.clientX,e.clientY),r=this.shapeView.shape.intersect(i);this.props.activePrism&&(t=this.intersectJunctions(i)),t&&(!r||t.hitDistance<r.hitDistance)?(this.pickedPrism=null,this.pickedJunction=t.hitJunction,this.activatePrismKnob(this.availableJunctions,this.pickedJunction)):(this.pickedPrism=r?r.hitPrism:null,this.pickedJunction=null),this.activeJunctionPrism=null,this.pressing=!0,this.dragging=!1,this.pointerX=e.clientX,this.pointerY=e.clientY}}},{key:"handlePointerUp",value:function(e){this.isPrimaryPointer(e)&&(this.activeJunctionPrism?this.addPrism(this.activeJunctionPrism):this.dragging||this.pickedJunction||(this.selectPrism(this.pickedPrism,!0),this.props.onActivePrismChange(this.pickedPrism)),this.pressing=!1,this.hideGhostPrism(),this.availableJunctions&&this.showPrismKnobs(this.availableJunctions))}},{key:"handlePointerMove",value:function(e){if(this.isPrimaryPointer(e)&&this.pressing){var t=e.clientX-this.pointerX,i=e.clientY-this.pointerY;if(this.dragging)if(this.pickedJunction){var r=this.getCastingRay(e.clientX,e.clientY),n=this.pickNearestJunctionPrism(r,this.pickedJunction);n!==this.activeJunctionPrism&&(this.showGhostPrism(n.worldPosition,n.worldOrientation),this.activeJunctionPrism=n)}else this.elevation=Math.min(Math.max(this.elevation-.01*i,-x),x),this.heading=(this.heading-.01*t)%(2*Math.PI),this.updateCamera(),this.pointerX=e.clientX,this.pointerY=e.clientY;else t*t+i*i>=9&&(this.pointerX=e.clientX,this.pointerY=e.clientY,this.dragging=!0)}}},{key:"getCastingRay",value:function(e,t){var i=window.devicePixelRatio,r=2*e*i/this.canvas.width-1,n=1-2*t*i/this.canvas.height,a=u.d.fromValues(r,n,-1,1);u.d.transformMat4(a,a,window.Filament.Camera.inverseProjection(this.camera.getProjectionMatrix())),a[2]=-1,a[3]=0,u.d.transformMat4(a,a,this.camera.getModelMatrix());var o=u.c.fromValues(a[0],a[1],a[2]);return u.c.normalize(o,o),{origin:this.camera.getPosition(),direction:o}}},{key:"intersectJunctions",value:function(e){if(this.availableJunctions){for(var t,i,r=0;r<this.availableJunctions.length;r++){var n=this.availableJunctions[r],a=w(e,n.pivot,.2);void 0!==a&&(void 0===i||a<i)&&(t=n,i=a)}if(t)return{hitJunction:t,hitDistance:i}}}},{key:"pickNearestJunctionPrism",value:function(e,t){for(var i,r=null,n=0;n<t.prisms.length;n++){var a=t.prisms[n],o=M(e,a.worldPosition);(void 0===i||o<i)&&(r=a,i=o)}return r}},{key:"selectPrism",value:function(e,t){u.c.copy(this.lastPosition,this.targetPosition),this.activePrismView&&this.setHighlightIntensity(this.activePrismView,0),e?(this.updateHighlightColor(e),this.activePrismView=this.shapeView.findPrismView(e.id),this.availableJunctions=this.shapeView.shape.getAvailableJunctions(e),this.showPrismKnobs(this.availableJunctions),u.c.copy(this.targetPosition,e.worldPosition)):(this.activePrismView=null,this.availableJunctions=null,this.hidePrismKnobs(),u.c.copy(this.targetPosition,this.shapeView.shape.aabb.center)),t?(this.animationTimer=0,this.highlightTimer=0):(this.highlightTimer=1,u.c.copy(this.lastPosition,this.targetPosition),u.c.copy(this.focalPoint,this.targetPosition),this.updateCamera())}},{key:"addPrism",value:function(e){var t=this.shapeView.shape.clone();e.id=++t.lastPrismId,t.prisms.push(e),t.applyTransform(),this.props.onShapeChange(t)}},{key:"updateHighlightColor",value:function(e){var t=f.a.readability(e.backgroundColor,"#ffff40")>f.a.readability(e.backgroundColor,"#b266ff")?"#ffff40":"#b266ff",i=f()(t).toRgb();this.highlightColor[0]=i.r/255,this.highlightColor[1]=i.g/255,this.highlightColor[2]=i.b/255}},{key:"setHighlightIntensity",value:function(e,t){var i=this.getRenderableMaterial(e.renderable);this.highlightColor[3]=t,i.setColor4Parameter("highlightColor",window.Filament.RgbaType.sRGB,this.highlightColor)}},{key:"showGhostPrism",value:function(e,t){this.setRenderableTransform(this.ghostRenderable,e,t),this.scene.addEntity(this.ghostRenderable)}},{key:"hideGhostPrism",value:function(){this.scene.remove(this.ghostRenderable)}},{key:"showPrismKnobs",value:function(e){for(;this.knobRenderables.length<e.length;)this.knobRenderables.push(this.createKnobRenderable());for(var t=0;t<e.length;t++){var i=e[t],r=this.knobRenderables[t];this.getRenderableMaterial(r).setFloatParameter("alpha",.3),this.setRenderableTransform(r,i.pivot,F),this.scene.addEntity(r)}for(var n=e.length;n<this.knobRenderables.length;n++){var a=this.knobRenderables[n];this.scene.remove(a)}}},{key:"activatePrismKnob",value:function(e,t){var i=e.indexOf(t),r=this.knobRenderables[i];this.getRenderableMaterial(r).setFloatParameter("alpha",1),this.hidePrismKnobs(),this.scene.addEntity(r)}},{key:"hidePrismKnobs",value:function(){var e=this;this.knobRenderables.forEach((function(t){return e.scene.remove(t)}))}},{key:"render",value:function(){var e=this;return n.a.createElement("canvas",{className:"Viewport",ref:function(t){return e.filament=t}})}}]),i}(r.Component),J=i(2),B=i.n(J),j=i(90),A=function(e){Object(l.a)(i,e);var t=Object(c.a)(i);function i(e){var r;return Object(s.a)(this,i),(r=t.call(this,e)).state={displayColorPicker:!1},r}return Object(h.a)(i,[{key:"handleToggleColorPicker",value:function(){this.setState({displayColorPicker:!this.state.displayColorPicker})}},{key:"handleHideColorPicker",value:function(){this.setState({displayColorPicker:!1})}},{key:"handleColorChange",value:function(e){this.props.onChange(e.hex),this.handleHideColorPicker()}},{key:"render",value:function(){var e=this,t=B()({default:{color:{width:"36px",height:"14px",borderRadius:"2px",background:this.props.color},swatch:{padding:"5px",background:"#fff",borderRadius:"1px",boxShadow:"0 0 0 1px rgba(0,0,0,.1)",display:"inline-block",cursor:"pointer"},popover:{position:"absolute",zIndex:"2"},cover:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}}});return n.a.createElement("div",null,n.a.createElement("div",{style:t.swatch,onClick:function(){return e.handleToggleColorPicker()}},n.a.createElement("div",{style:t.color})),this.state.displayColorPicker?n.a.createElement("div",{style:t.popover},n.a.createElement("div",{style:t.cover,onClick:function(){return e.handleHideColorPicker()}}),n.a.createElement(j.SwatchesPicker,{color:this.props.color,width:"220px",height:"220px",onChange:function(t){return e.handleColorChange(t)}})):null)}}]),i}(r.Component),N=function(e){Object(l.a)(i,e);var t=Object(c.a)(i);function i(){return Object(s.a)(this,i),t.apply(this,arguments)}return Object(h.a)(i,[{key:"modifyShape",value:function(e,t){var i=e.clone();t(i),i.applyTransform(),this.props.onShapeChange(i)}},{key:"modifyPrism",value:function(e,t,i){this.modifyShape(e,(function(e){var r=e.findPrism(t.id);i(r)}))}},{key:"handleRollChange",value:function(e,t){this.modifyShape(e,(function(e){return e.roll=parseFloat(t)||0}))}},{key:"handlePitchChange",value:function(e,t){this.modifyShape(e,(function(e){return e.pitch=parseFloat(t)||0}))}},{key:"handleYawChange",value:function(e,t){this.modifyShape(e,(function(e){return e.yaw=parseFloat(t)||0}))}},{key:"handleColorMaskChange",value:function(e,t,i){this.modifyPrism(e,t,(function(e){return e.colorMask=parseInt(i)||0}))}},{key:"handleBackgroundColorChange",value:function(e,t,i){this.modifyPrism(e,t,(function(e){return e.backgroundColor=i}))}},{key:"handleForegroundColorChange",value:function(e,t,i){this.modifyPrism(e,t,(function(e){return e.foregroundColor=i}))}},{key:"handleSwapColors",value:function(e,t){this.modifyPrism(e,t,(function(e){e.foregroundColor=t.backgroundColor,e.backgroundColor=t.foregroundColor}))}},{key:"renderShapeParams",value:function(e){var t=this;return n.a.createElement("div",{className:"Params"},n.a.createElement("h3",null,"Shape"),n.a.createElement("p",null,n.a.createElement("label",{htmlFor:"roll"},"Roll : "),n.a.createElement("input",{type:"number",id:"roll",name:"roll",min:"-180",max:"180",step:"15",value:e.roll,onChange:function(i){return t.handleRollChange(e,i.target.value)}})),n.a.createElement("p",null,n.a.createElement("label",{htmlFor:"pitch"},"Pitch : "),n.a.createElement("input",{type:"number",id:"pitch",name:"pitch",min:"-180",max:"180",step:"15",value:e.pitch,onChange:function(i){return t.handlePitchChange(e,i.target.value)}})),n.a.createElement("p",null,n.a.createElement("label",{htmlFor:"yaw"},"Yaw : "),n.a.createElement("input",{type:"number",id:"yaw",name:"yaw",min:"-180",max:"180",step:"15",value:e.yaw,onChange:function(i){return t.handleYawChange(e,i.target.value)}})))}},{key:"renderPrismParams",value:function(e,t){var i=this;return n.a.createElement("div",{className:"Params"},n.a.createElement("h3",null,"Prism"),n.a.createElement("p",null,n.a.createElement("label",{htmlFor:"colorMask"},"Mask : "),n.a.createElement("input",{type:"number",id:"colorMask",name:"colorMask",min:"0",max:7,step:"1",value:t.colorMask,onChange:function(r){return i.handleColorMaskChange(e,t,r.target.value)}})),n.a.createElement("div",null,n.a.createElement("label",{htmlFor:"backgroundColor"},"Background : "),n.a.createElement(A,{id:"backgroundColor",name:"backgroundColor",color:t.backgroundColor,onChange:function(r){return i.handleBackgroundColorChange(e,t,r)}})),n.a.createElement("div",null,n.a.createElement("label",{htmlFor:"foregroundColor"},"Foreground : "),n.a.createElement(A,{id:"foregroundColor",name:"foregroundColor",color:t.foregroundColor,onChange:function(r){return i.handleForegroundColorChange(e,t,r)}})),n.a.createElement("p",null,n.a.createElement("button",{id:"swapColors",name:"swapColors",onClick:function(){return i.handleSwapColors(e,t)}},"Swap")))}},{key:"renderParams",value:function(){return this.props.activePrism?this.renderPrismParams(this.props.shape,this.props.activePrism):this.renderShapeParams(this.props.shape)}},{key:"render",value:function(){return n.a.createElement("div",{className:"Toolbar"},this.renderParams())}}]),i}(r.Component);function Y(e,t){return{position:e,orientation:t}}function z(e,t,i,r){var n=u.b.setAxisAngle(u.b.create(),i,r),a=u.c.sub(u.c.create(),e.position,t);u.c.transformQuat(a,a,n),u.c.add(a,a,t);var o=u.b.mul(n,n,e.orientation);return u.b.normalize(o,o),Y(a,o)}function L(e,t){var i=u.c.transformQuat(u.c.create(),t.position,e.orientation);u.c.add(i,i,e.position);var r=u.b.mul(u.b.create(),e.orientation,t.orientation);return u.b.normalize(r,r),Y(i,r)}var X=Math.sqrt(2),K=.5*X,G=[u.c.fromValues(-1,-.5,-K),u.c.fromValues(-1,-.5,K),u.c.fromValues(0,.5,-K),u.c.fromValues(0,.5,K),u.c.fromValues(1,-.5,-K),u.c.fromValues(1,-.5,K)],D=[0,1,2,2,1,3,2,3,4,4,3,5,4,5,0,0,5,1,0,2,4,5,3,1],H=[[0,1,2,3],[2,3,5,4],[1,0,4,5],[0,2,4],[5,3,1]].map((function(e){var t=G[e[0]],i=G[e[1]],r=G[e[2]],n=u.c.sub(u.c.create(),i,t);return u.c.cross(n,n,u.c.sub(u.c.create(),r,t)),u.c.normalize(n,n)})),Q=u.c.fromValues(-.5,0,0),_=u.c.fromValues(.5,0,0),q=u.c.rotateZ(u.c.create(),u.c.fromValues(0,1,0),u.c.fromValues(0,0,0),.25*Math.PI),W=u.c.rotateZ(u.c.create(),u.c.fromValues(0,1,0),u.c.fromValues(0,0,0),-.25*Math.PI),$=Y(u.c.fromValues(-1,0,0),u.b.fromEuler(u.b.create(),-180,0,0)),U=Y(u.c.fromValues(1,0,0),u.b.fromEuler(u.b.create(),180,0,0)),Z=[{swapColors:!0,pivot:Q,normal:q,transforms:[$,z($,Q,q,.5*Math.PI),z($,Q,q,Math.PI),z($,Q,q,-.5*Math.PI)]},{swapColors:!0,pivot:_,normal:W,transforms:[U,z(U,_,W,-.5*Math.PI),z(U,_,W,Math.PI),z(U,_,W,.5*Math.PI)]},{swapColors:!1,pivot:u.c.fromValues(0,-.5/6,K),normal:u.c.fromValues(0,0,1),transforms:[Y(u.c.fromValues(0,0,X),u.b.create())]},{swapColors:!1,pivot:u.c.fromValues(0,-.5/6,-K),normal:u.c.fromValues(0,0,-1),transforms:[Y(u.c.fromValues(0,0,-X),u.b.create())]},{swapColors:!1,pivot:u.c.fromValues(0,-.5,0),normal:u.c.fromValues(0,-1,0),transforms:[Y(u.c.fromValues(0,-1,0),u.b.fromEuler(u.b.create(),180,0,0))]}],ee=function(){function e(){Object(s.a)(this,e),this.id=0,this.colorMask=0,this.backgroundColor="#000",this.foregroundColor="#fff",this.position=u.c.create(),this.orientation=u.b.create(),this.worldPosition=u.c.create(),this.worldOrientation=u.b.create(),this.vertices=G.map((function(e){return u.c.clone(e)})),this.polygonNormals=H.map((function(e){return u.c.clone(e)}))}return Object(h.a)(e,[{key:"applyTransform",value:function(e){u.c.transformQuat(this.worldPosition,this.position,e),u.b.multiply(this.worldOrientation,e,this.orientation);for(var t=0;t<this.vertices.length;t++){var i=this.vertices[t];u.c.transformQuat(i,G[t],this.worldOrientation),u.c.add(i,i,this.worldPosition)}for(var r=0;r<this.polygonNormals.length;r++)u.c.transformQuat(this.polygonNormals[r],H[r],this.worldOrientation)}},{key:"intersect",value:function(e){return function(e,t,i){for(var r,n=0;n<i.length;n+=3){var a=y(e,t[i[n]],t[i[n+1]],t[i[n+2]]);void 0!==a&&(void 0===r||a<r)&&(r=a)}return r}(e,this.vertices,D)}},{key:"collides",value:function(e){return t=this.vertices,i=this.polygonNormals,r=e.vertices,n=e.polygonNormals,i.every((function(e){return C(e,t,r)}))&&n.every((function(e){return C(e,t,r)}));var t,i,r,n}},{key:"getJunctions",value:function(){for(var t=[],i=Y(this.position,this.orientation),r=0;r<Z.length;r++){for(var n=Z[r],a=[],o=0;o<n.transforms.length;o++){var s=L(i,n.transforms[o]),h=new e;h.colorMask=this.colorMask,h.backgroundColor=n.swapColors?this.foregroundColor:this.backgroundColor,h.foregroundColor=n.swapColors?this.backgroundColor:this.foregroundColor,u.c.copy(h.position,s.position),u.b.copy(h.orientation,s.orientation),a.push(h)}var l=u.c.transformQuat(u.c.create(),n.pivot,this.orientation);u.c.add(l,l,this.position);var c=u.c.transformQuat(u.c.create(),n.normal,this.orientation);t.push({pivot:l,normal:c,prisms:a})}return t}},{key:"clone",value:function(){var t=new e;return t.id=this.id,t.colorMask=this.colorMask,t.backgroundColor=this.backgroundColor,t.foregroundColor=this.foregroundColor,u.c.copy(t.position,this.position),u.b.copy(t.orientation,this.orientation),u.c.copy(t.worldPosition,this.worldPosition),u.b.copy(t.worldOrientation,this.worldOrientation),t}}]),e}(),te=Math.PI/180,ie=function(){function e(){Object(s.a)(this,e),this.prisms=[],this.lastPrismId=0,this.roll=0,this.pitch=0,this.yaw=0,this.aabb={min:u.c.create(),max:u.c.create(),center:u.c.create()}}return Object(h.a)(e,[{key:"getOrientation",value:function(){var e=u.b.create();return u.b.rotateY(e,e,this.yaw*te),u.b.rotateX(e,e,this.roll*te),u.b.rotateZ(e,e,this.pitch*te),e}},{key:"applyTransform",value:function(){var e=this.getOrientation();u.c.zero(this.aabb.min),u.c.zero(this.aabb.max);for(var t=0;t<this.prisms.length;t++){var i=this.prisms[t];i.applyTransform(e);for(var r=0;r<i.vertices.length;r++){var n=i.vertices[r];0===t&&0===r?(u.c.copy(this.aabb.min,n),u.c.copy(this.aabb.max,n)):(u.c.min(this.aabb.min,this.aabb.min,n),u.c.max(this.aabb.max,this.aabb.max,n))}}u.c.add(this.aabb.center,this.aabb.min,this.aabb.max),u.c.scale(this.aabb.center,this.aabb.center,.5)}},{key:"findPrism",value:function(e){for(var t=0;t<this.prisms.length;t++){var i=this.prisms[t];if(i.id===e)return i}return null}},{key:"intersect",value:function(e){for(var t,i,r=0;r<this.prisms.length;r++){var n=this.prisms[r],a=n.intersect(e);void 0!==a&&(void 0===i||a<i)&&(t=n,i=a)}if(t)return{hitPrism:t,hitDistance:i}}},{key:"getAvailableJunctions",value:function(e){var t=this,i=this.getOrientation(),r=e.getJunctions();return r.forEach((function(r){u.c.transformQuat(r.pivot,r.pivot,i),u.c.transformQuat(r.normal,r.normal,i),r.prisms.forEach((function(e){return e.applyTransform(i)})),r.prisms=r.prisms.filter((function(i){return t.prisms.every((function(t){return t===e||!t.collides(i)}))}))})),r.filter((function(e){return e.prisms.length>0}))}},{key:"clone",value:function(){for(var t=new e,i=0;i<this.prisms.length;i++)t.prisms.push(this.prisms[i].clone());return t.lastPrismId=this.lastPrismId,t.roll=this.roll,t.pitch=this.pitch,t.yaw=this.yaw,u.c.copy(t.aabb.min,this.aabb.min),u.c.copy(t.aabb.max,this.aabb.max),u.c.copy(t.aabb.center,this.aabb.center),t}}],[{key:"createInitialShape",value:function(){var t=new e,i=new ee;return i.id=++t.lastPrismId,i.backgroundColor="#1976d2",i.foregroundColor="#d9d9d9",t.prisms.push(i),t.applyTransform(),t}}]),e}(),re=function(e){Object(l.a)(i,e);var t=Object(c.a)(i);function i(e){var r;return Object(s.a)(this,i),(r=t.call(this,e)).state={shape:ie.createInitialShape(),activePrism:null},r}return Object(h.a)(i,[{key:"handleShapeChange",value:function(e){var t={shape:e};this.state.activePrism&&(t.activePrism=e.findPrism(this.state.activePrism.id)),this.setState(t)}},{key:"handleActivePrismChange",value:function(e){this.setState({activePrism:e})}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"App"},n.a.createElement(O,{shape:this.state.shape,activePrism:this.state.activePrism,onShapeChange:function(t){return e.handleShapeChange(t)},onActivePrismChange:function(t){return e.handleActivePrismChange(t)}}),n.a.createElement(N,{shape:this.state.shape,activePrism:this.state.activePrism,onShapeChange:function(t){return e.handleShapeChange(t)}}))}}]),i}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(re,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},35:function(e,t,i){},95:function(e,t,i){e.exports=i(266)}},[[95,1,2]]]);
//# sourceMappingURL=main.a6744e2b.chunk.js.map